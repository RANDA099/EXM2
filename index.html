<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Pro</title>

<script src="https://unpkg.com/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
:root {
  --bg:#f2f2f2; --card:#fff; --text:#111; --main:#4d61fc; --secondary:#00c853; --danger:#ff4444;
}
body.dark {--bg:#0f1115;--card:#1c1f26;--text:#fff;}
body {margin:0;font-family:system-ui;background:var(--bg);color:var(--text);display:flex;justify-content:center;align-items:flex-start;min-height:100vh;padding:20px;}
.app {background:var(--card);width:100%;max-width:480px;border-radius:22px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.15);}
h1{text-align:center;color:var(--main);margin-bottom:15px;}
input,select,button{width:100%;padding:12px;border-radius:14px;border:none;margin:6px 0;font-size:15px}
input,select{background:#eee}
body.dark input,body.dark select{background:#2a2d36;color:white}
button{background:var(--main);color:white;font-weight:bold;cursor:pointer;transition:all 0.2s}
button:hover{opacity:0.85}
#qrcode{display:flex;justify-content:center;margin:15px 0;position:relative;perspective:1000px;}
.toggle{text-align:center;cursor:pointer;font-size:14px;margin-top:10px;}
#reader{margin-top:10px;border-radius:12px;overflow:hidden;}
.history-window{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:none;justify-content:center;align-items:center;z-index:1000;}
.history-content{background:white;padding:25px;border-radius:20px;width:90%;max-width:420px;max-height:80vh;overflow-y:auto;}
.history-item{padding:10px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;}
.history-item:hover{background:#f5f5f5;}
label{margin-top:8px;display:block;cursor:pointer;}
.effect-select{margin-top:6px;}
.logo-size-slider{display:flex;align-items:center;gap:10px;margin-top:6px;}
.logo-size-slider input{flex:1;}
.download-btns{display:flex;gap:10px;margin-top:6px;}
.advanced-options{margin-top:6px;padding:10px;border:1px solid #ddd;border-radius:10px;display:none;}
</style>
</head>
<body>

<div class="app">
  <h1>ğŸ”³ QR Pro</h1>

  <input id="data" placeholder="Ø±Ø§Ø¨Ø· Ø£Ùˆ Ù†Øµ">

  <label>ğŸ–Œï¸ Ù†ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</label>
  <select id="style">
    <option value="square">â¬› Ù…Ø±Ø¨Ø¹</option>
    <option value="dots">âš« Ù†Ù‚Ø§Ø·</option>
    <option value="rounded">â—¼ï¸ Ù…Ø³ØªØ¯ÙŠØ±</option>
  </select>

  <label>ğŸ‘ï¸ Ø´ÙƒÙ„ Ø§Ù„Ø¹ÙŠÙˆÙ†</label>
  <select id="eyeStyle">
    <option value="square">â¬› Ù…Ø±Ø¨Ø¹</option>
    <option value="dots">âš« Ø¯Ø§Ø¦Ø±ÙŠ</option>
    <option value="rounded">â—¼ï¸ Ù…Ø³ØªØ¯ÙŠØ±</option>
  </select>

  <label>ğŸ¨ Ù„ÙˆÙ† QR</label>
  <input type="color" id="color">

  <label>ğŸŒˆ ØªØ£Ø«ÙŠØ±</label>
  <select id="effect" class="effect-select">
    <option value="none">Ø¨Ø¯ÙˆÙ†</option>
    <option value="shadow">Ø¸Ù„</option>
    <option value="glow">ØªÙˆÙ‡Ø¬</option>
    <option value="animated">ğŸ”„ Ù…ØªØ­Ø±Ùƒ</option>
    <option value="rainbow">ğŸŒˆ Ù‚ÙˆØ³ Ù‚Ø²Ø­ Ù…ØªØ¯Ø±Ø¬</option>
    <option value="pulse">ğŸ’“ Ù†Ø¨Ø¶</option>
    <option value="wave">ğŸŒŠ Ù…ÙˆØ¬Ø©</option>
    <option value="3d">ğŸŒ€ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯</option>
  </select>

  <label>ğŸï¸ Ø´Ø¹Ø§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
  <input type="text" id="logo" placeholder="Ø±Ø§Ø¨Ø· Ø´Ø¹Ø§Ø±">

  <label>ğŸ”¹ Ø­Ø¬Ù… Ø§Ù„Ø´Ø¹Ø§Ø±</label>
  <div class="logo-size-slider">
    <span>10</span>
    <input type="range" id="logoSize" min="10" max="50" step="5" value="40">
    <span>50</span>
  </div>

  <label>ğŸ”¹ Ø´ÙØ§ÙÙŠØ© Ø§Ù„Ø´Ø¹Ø§Ø±</label>
  <input type="range" id="logoOpacity" min="0" max="1" step="0.05" value="1">

  <label>ğŸ¨ Ø®Ù„ÙÙŠØ© Gradient</label>
  <input type="text" id="bgGradient">

  <!-- Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù…Ø·ÙˆÙŠØ© -->
  <label onclick="toggleAdvanced()">âš™ï¸ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</label>
  <div id="advanced-options" class="advanced-options">
    <label><input type="checkbox" id="encryptData"> ğŸ”’ ØªØ´ÙÙŠØ± Ø§Ù„Ù†Øµ Ù‚Ø¨Ù„ ØªÙˆÙ„ÙŠØ¯ QR</label>
    <label>ğŸ¨ Ø£Ù„ÙˆØ§Ù† Ø¥Ø¶Ø§ÙÙŠØ©</label>
    <input type="color" id="extraColor1" value="#0000ff">
    <input type="color" id="extraColor2" value="#00ff00">
    <input type="color" id="extraColor3" value="#ffffff">
  </div>

  <button onclick="generate()">âš¡ ØªÙˆÙ„ÙŠØ¯ QR</button>

  <div id="qrcode"></div>

  <div class="download-btns">
    <button onclick="download('png')">â¬‡ PNG</button>
    <button onclick="download('jpg')">â¬‡ JPG</button>
  </div>

  <button onclick="startScan()">ğŸ“· Ù…Ø³Ø­ QR</button>
  <button onclick="showHistory()">ğŸ“œ Ø§Ù„ØªØ§Ø±ÙŠØ®</button>

  <div id="reader"></div>

  <div class="toggle" onclick="toggleDark()">ğŸŒ™ / â˜€ï¸ ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„</div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® -->
<div id="history-window" class="history-window">
  <div class="history-content">
    <h3>ğŸ“œ ØªØ§Ø±ÙŠØ® Ø±Ù…ÙˆØ² QR</h3>
    <div id="history-list"></div>
    <button onclick="closeHistory()" style="margin-top:10px;background:var(--danger);color:white;padding:10px;border:none;border-radius:10px;cursor:pointer;">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
let qr, scanner, history = JSON.parse(localStorage.getItem("qrHistory")||"[]");
const dataInput=document.getElementById("data");

if(localStorage.theme==="dark") document.body.classList.add("dark");

function toggleAdvanced(){
  const adv=document.getElementById("advanced-options");
  adv.style.display = adv.style.display==="none"?"block":"none";
}

function getDataToGenerate(){
  let data = dataInput.value.trim();
  if(document.getElementById("encryptData").checked){
    data = btoa(data); // ØªØ´ÙÙŠØ± Base64
  }
  return data;
}

function generate(){
  const data = getDataToGenerate();
  if(!data) return alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ù…Ø­ØªÙˆÙ‰ Ø£ÙˆÙ„Ø§Ù‹");

  const styleVal=document.getElementById("style").value;
  const eyeVal=document.getElementById("eyeStyle").value;
  const colorVal=document.getElementById("color").value || "#000000";
  const logoVal=document.getElementById("logo").value.trim()||null;
  const logoSize = parseInt(document.getElementById("logoSize").value);
  const logoOpacity=document.getElementById("logoOpacity").value||1;
  const effect=document.getElementById("effect").value;
  const bgGradient=document.getElementById("bgGradient").value.trim()||null;

  qrcode.innerHTML="";

  let bgColor = document.body.classList.contains("dark")?"#1c1f26":"#fff";
  if(bgGradient) bgColor=bgGradient;

  qr = new QRCodeStyling({
    width:300,height:300,data,
    dotsOptions:{type:styleVal,color:colorVal},
    cornersSquareOptions:{type:eyeVal,color:colorVal},
    backgroundOptions:{color:bgColor},
    imageOptions:{crossOrigin:"anonymous",margin:5,image:logoVal,width:logoSize,height:logoSize,opacity:logoOpacity},
    qrOptions:{color:colorVal,margin:10}
  });

  qr.append(qrcode);

  const canvas=qr._canvas;
  const ctx=canvas.getContext("2d");

  if(effect==="shadow"){
    canvas.style.filter="drop-shadow(0 0 8px rgba(0,0,0,0.7))";
  } else if(effect==="glow"){
    canvas.style.filter="drop-shadow(0 0 15px "+colorVal+")";
  } else if(effect==="animated"){
    canvas.style.animation="rotateQR 4s linear infinite";
  } else if(effect==="rainbow"){
    const gradient=ctx.createLinearGradient(0,0,300,300);
    gradient.addColorStop(0,"#00c853");gradient.addColorStop(0.2,"#4d61fc");
    gradient.addColorStop(0.4,"#00c853");gradient.addColorStop(0.6,"#000000");
    gradient.addColorStop(0.8,"#4d61fc");gradient.addColorStop(1,"#00c853");
    qr.update({dotsOptions:{type:styleVal,color:gradient}});
  } else if(effect==="pulse"){
    canvas.style.animation="pulseQR 1.5s infinite";
  } else if(effect==="wave"){
    for(let y=0;y<300;y+=10){
      const grad=ctx.createLinearGradient(0,y,300,y);
      grad.addColorStop(0,"#00c853");grad.addColorStop(0.2,"#4d61fc");
      grad.addColorStop(0.4,"#000000");grad.addColorStop(0.6,"#00c853");
      grad.addColorStop(0.8,"#4d61fc");grad.addColorStop(1,"#00c853");
      ctx.fillStyle=grad;ctx.fillRect(0,y,300,10);
    }
  } else if(effect==="3d"){
    canvas.style.transform="rotateX(15deg) rotateY(15deg) scale(1.05)";
    canvas.style.boxShadow="0 10px 20px rgba(0,0,0,0.4)";
  } else{
    canvas.style.filter="none";canvas.style.animation="none";canvas.style.transform="none";canvas.style.boxShadow="none";
  }

  addToHistory(data, styleVal, eyeVal, colorVal, logoVal, logoSize, logoOpacity, effect, bgGradient);
}

const styleEl=document.createElement('style');
styleEl.innerHTML=`
@keyframes rotateQR {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
@keyframes pulseQR {0%{transform:scale(1);}50%{transform:scale(1.1);}100%{transform:scale(1);}}
`;
document.head.appendChild(styleEl);

function download(ext){ if(!qr){alert("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ QR Ø£ÙˆÙ„Ø§Ù‹");return;} qr.download({name:"QRPro",extension:ext}); }

function toggleDark(){ document.body.classList.toggle("dark"); localStorage.theme=document.body.classList.contains("dark")?"dark":"light"; }

function startScan(){
  scanner=new Html5Qrcode("reader");
  scanner.start({facingMode:"environment"},{fps:10,qrbox:250},txt=>{
    dataInput.value=txt; generate(); scanner.stop();
  });
}

function addToHistory(data, style, eye, color, logo, logoSize, logoOpacity, effect, bgGradient){
  const item={id:Date.now(),data,style,eye,color,logo,logoSize,logoOpacity,effect,bgGradient};
  history.unshift(item); if(history.length>20) history=history.slice(0,20);
  localStorage.setItem("qrHistory",JSON.stringify(history));
}

function showHistory(){
  const list=document.getElementById("history-list"); list.innerHTML="";
  if(history.length===0){list.innerHTML="<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ§Ø±ÙŠØ® Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>";}
  history.forEach(item=>{
    const div=document.createElement("div");
    div.className="history-item";
    div.innerHTML=`<span>${item.data.substring(0,30)}${item.data.length>30?"...":""}</span>
      <button onclick='loadHistory(${item.id})' style="background:var(--main);color:white;border:none;padding:5px;border-radius:5px;">Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯</button>`;
    list.appendChild(div);
  });
  document.getElementById("history-window").style.display="flex";
}

function closeHistory(){document.getElementById("history-window").style.display="none";}

function loadHistory(id){
  const item=history.find(i=>i.id===id);
  if(item){
    dataInput.value=item.data;
    document.getElementById("style").value=item.style;
    document.getElementById("eyeStyle").value=item.eye;
    document.getElementById("color").value=item.color;
    document.getElementById("logo").value=item.logo||"";
    document.getElementById("logoSize").value=item.logoSize||40;
    document.getElementById("logoOpacity").value=item.logoOpacity||1;
    document.getElementById("effect").value=item.effect||"none";
    document.getElementById("bgGradient").value=item.bgGradient||"";
    generate(); closeHistory();
  }
}

if("serviceWorker"in navigator){navigator.serviceWorker.register("sw.js");}
</script>

</body>
</html>